//
// Created by daran on 1/12/2017 to be used in ECE420 Sp17 for the first time.
// Modified by dwang49 on 1/1/2018 to adapt to Android 7.0 and Shield Tablet updates.
//

#include <jni.h>
#include "ece420_main.h"
#include "ece420_lib.h"
#include "kiss_fft/kiss_fft.h"
#include "gist/Gist.h"

#define PI 3.141592653589793238463

double audio_frame[1024] = {0.0102635156363,
                            -0.0223054625094,
                            -0.049139097333,
                            -0.0680057257414,
                            -0.0757518112659,
                            -0.0714487805963,
                            -0.0621639043093,
                            -0.0511482395232,
                            -0.0394551865757,
                            -0.0326095893979,
                            -0.0273744072765,
                            -0.0174853559583,
                            -0.000863695517182,
                            0.0184232257307,
                            0.0284592695534,
                            0.0219880919904,
                            0.000215299427509,
                            -0.035387583077,
                            -0.0803403034806,
                            -0.123472824693,
                            -0.156837388873,
                            -0.175961107016,
                            -0.176274344325,
                            -0.159213870764,
                            -0.128778338432,
                            -0.0890771448612,
                            -0.0477101318538,
                            -0.0127063654363,
                            0.01248068735,
                            0.0272238440812,
                            0.0380614064634,
                            0.0436200872064,
                            0.042426917702,
                            0.0439958013594,
                            0.0525063537061,
                            0.061752744019,
                            0.0622550696135,
                            0.0590439327061,
                            0.0454982817173,
                            0.0171200633049,
                            -0.009506681934,
                            -0.0242084600031,
                            -0.0356363132596,
                            -0.0517705604434,
                            -0.0599030777812,
                            -0.0588054023683,
                            -0.0546612367034,
                            -0.0420779772103,
                            -0.0205326154828,
                            -0.00965496618301,
                            -0.000842022011057,
                            0.0192465726286,
                            0.0416044443846,
                            0.0671387314796,
                            0.0923545733094,
                            0.112191848457,
                            0.124335430562,
                            0.127598926425,
                            0.124988920987,
                            0.122565850616,
                            0.125953495502,
                            0.137175157666,
                            0.151234999299,
                            0.162278741598,
                            0.166909739375,
                            0.16821359098,
                            0.177861168981,
                            0.196719706059,
                            0.215001270175,
                            0.222365394235,
                            0.226171135902,
                            0.239066049457,
                            0.254847854376,
                            0.271088421345,
                            0.286447763443,
                            0.293817967176,
                            0.293569147587,
                            0.281794190407,
                            0.253540128469,
                            0.21720084548,
                            0.182446777821,
                            0.158773347735,
                            0.154112830758,
                            0.163525462151,
                            0.17748041451,
                            0.184484869242,
                            0.175658047199,
                            0.151873067021,
                            0.111902207136,
                            0.0577340498567,
                            0.00516444537789,
                            -0.0308337025344,
                            -0.0493192598224,
                            -0.051333039999,
                            -0.0411602705717,
                            -0.0317490883172,
                            -0.0226252358407,
                            -0.00772610958666,
                            0.00273630861193,
                            -0.0093135163188,
                            -0.0454127900302,
                            -0.0907622128725,
                            -0.12865883112,
                            -0.151185825467,
                            -0.163198754191,
                            -0.168869152665,
                            -0.169822871685,
                            -0.16175545752,
                            -0.13855701685,
                            -0.107586584985,
                            -0.0809900760651,
                            -0.0666029751301,
                            -0.0649482905865,
                            -0.0720081627369,
                            -0.0870150700212,
                            -0.109926186502,
                            -0.136536002159,
                            -0.160062432289,
                            -0.178649127483,
                            -0.199531704187,
                            -0.227810963988,
                            -0.261177718639,
                            -0.293714851141,
                            -0.318779915571,
                            -0.333917468786,
                            -0.343041181564,
                            -0.345926493406,
                            -0.335068106651,
                            -0.309725046158,
                            -0.274585276842,
                            -0.238536223769,
                            -0.207194268703,
                            -0.182464540005,
                            -0.168533325195,
                            -0.164222344756,
                            -0.164692282677,
                            -0.172426640987,
                            -0.183288648725,
                            -0.186779022217,
                            -0.181055396795,
                            -0.168256416917,
                            -0.14787311852,
                            -0.123087823391,
                            -0.0996470376849,
                            -0.0773971006274,
                            -0.0530610457063,
                            -0.0235185995698,
                            0.0122940680012,
                            0.0429771617055,
                            0.0607446804643,
                            0.0607520602643,
                            0.0448047406971,
                            0.0173711143434,
                            -0.0144142955542,
                            -0.0419646799564,
                            -0.0631296858191,
                            -0.0771313756704,
                            -0.0756466984749,
                            -0.0613696947694,
                            -0.0397557616234,
                            -0.0103587089106,
                            0.0135334795341,
                            0.0309294629842,
                            0.0490730032325,
                            0.0682647302747,
                            0.0941602736712,
                            0.123238891363,
                            0.155791670084,
                            0.197217851877,
                            0.233671009541,
                            0.254329055548,
                            0.266022115946,
                            0.26778024435,
                            0.246514245868,
                            0.210654273629,
                            0.179993316531,
                            0.150922805071,
                            0.124206498265,
                            0.109079793096,
                            0.102038286626,
                            0.105837389827,
                            0.115761160851,
                            0.122719749808,
                            0.128610193729,
                            0.131498545408,
                            0.136959865689,
                            0.150283291936,
                            0.167203590274,
                            0.184103175998,
                            0.200390338898,
                            0.213217392564,
                            0.219200283289,
                            0.215121939778,
                            0.200731232762,
                            0.191773042083,
                            0.192706957459,
                            0.200004115701,
                            0.210574448109,
                            0.21481180191,
                            0.207539260387,
                            0.195565536618,
                            0.187269106507,
                            0.18183888495,
                            0.179058462381,
                            0.174318224192,
                            0.166502699256,
                            0.15809096396,
                            0.150861084461,
                            0.145223110914,
                            0.142255604267,
                            0.143820151687,
                            0.148766562343,
                            0.154855787754,
                            0.155923217535,
                            0.150979697704,
                            0.146196499467,
                            0.140813440084,
                            0.133441060781,
                            0.122397333384,
                            0.099407941103,
                            0.0618578344584,
                            0.0180715080351,
                            -0.0267453640699,
                            -0.0690425112844,
                            -0.104053817689,
                            -0.128407821059,
                            -0.141017854214,
                            -0.140519455075,
                            -0.132250517607,
                            -0.128322944045,
                            -0.136410474777,
                            -0.151839271188,
                            -0.168212801218,
                            -0.185927793384,
                            -0.207858562469,
                            -0.236356437206,
                            -0.264861673117,
                            -0.28378662467,
                            -0.287689894438,
                            -0.278316318989,
                            -0.263069272041,
                            -0.24709674716,
                            -0.233454167843,
                            -0.22513255477,
                            -0.220395207405,
                            -0.228047534823,
                            -0.242566153407,
                            -0.251211971045,
                            -0.261713445187,
                            -0.265517771244,
                            -0.256067365408,
                            -0.236807644367,
                            -0.211602777243,
                            -0.184276372194,
                            -0.153607308865,
                            -0.135285824537,
                            -0.132034748793,
                            -0.130124419928,
                            -0.121866330504,
                            -0.111470460892,
                            -0.100898817182,
                            -0.0863898992538,
                            -0.0716623738408,
                            -0.0603867247701,
                            -0.0539009459317,
                            -0.0453245565295,
                            -0.0390160046518,
                            -0.0360087193549,
                            -0.0386725403368,
                            -0.0431742034853,
                            -0.0499717704952,
                            -0.059757374227,
                            -0.07517863065,
                            -0.0952273011208,
                            -0.108564041555,
                            -0.120115466416,
                            -0.12756177783,
                            -0.133501842618,
                            -0.141322568059,
                            -0.148757591844,
                            -0.15026961267,
                            -0.137981787324,
                            -0.111923612654,
                            -0.0829741954803,
                            -0.0615005977452,
                            -0.0512679293752,
                            -0.0534346364439,
                            -0.0615324303508,
                            -0.072344250977,
                            -0.0792932957411,
                            -0.0782346725464,
                            -0.0676799565554,
                            -0.0438298694789,
                            -0.0105531234294,
                            0.0343369580805,
                            0.0866517871618,
                            0.138566866517,
                            0.187303215265,
                            0.22734336555,
                            0.255808532238,
                            0.272237896919,
                            0.275785684586,
                            0.265058636665,
                            0.251829683781,
                            0.237648591399,
                            0.214098572731,
                            0.191761553288,
                            0.16434442997,
                            0.130895093083,
                            0.100069649518,
                            0.0738396123052,
                            0.0642438232899,
                            0.0692242309451,
                            0.0859737992287,
                            0.107424534857,
                            0.125936701894,
                            0.141472712159,
                            0.145475253463,
                            0.135762870312,
                            0.116501837969,
                            0.0904956236482,
                            0.0582094863057,
                            0.0294543690979,
                            0.0107915857807,
                            0.00611341558397,
                            0.0098203709349,
                            0.0153822470456,
                            0.019045656547,
                            0.0214133225381,
                            0.0276776049286,
                            0.04046022892,
                            0.0617830678821,
                            0.0880471020937,
                            0.118294999003,
                            0.148746758699,
                            0.176675736904,
                            0.200789988041,
                            0.219840347767,
                            0.235853910446,
                            0.250766217709,
                            0.262807935476,
                            0.268895715475,
                            0.270780295134,
                            0.270217508078,
                            0.268645554781,
                            0.269093215466,
                            0.267340123653,
                            0.258347660303,
                            0.243146285415,
                            0.222362503409,
                            0.197983473539,
                            0.173700511456,
                            0.148306548595,
                            0.119903884828,
                            0.0904670506716,
                            0.0565647222102,
                            0.0207018516958,
                            -0.0167241189629,
                            -0.0605399534106,
                            -0.102882102132,
                            -0.137348815799,
                            -0.167575314641,
                            -0.190909609199,
                            -0.206234797835,
                            -0.22077845037,
                            -0.231721624732,
                            -0.236077725887,
                            -0.227563992143,
                            -0.207352697849,
                            -0.187064602971,
                            -0.169782325625,
                            -0.157360821962,
                            -0.147218286991,
                            -0.137052178383,
                            -0.126763507724,
                            -0.118612781167,
                            -0.114785768092,
                            -0.107624202967,
                            -0.0997267961502,
                            -0.0956063643098,
                            -0.0905595496297,
                            -0.0835196450353,
                            -0.0750044584274,
                            -0.0685487538576,
                            -0.066481731832,
                            -0.0707144290209,
                            -0.0794651582837,
                            -0.0930492952466,
                            -0.113698512316,
                            -0.134775400162,
                            -0.155419409275,
                            -0.171377718449,
                            -0.178270488977,
                            -0.176796630025,
                            -0.167940139771,
                            -0.156731769443,
                            -0.145454823971,
                            -0.135382771492,
                            -0.128194585443,
                            -0.121235989034,
                            -0.111012868583,
                            -0.102622382343,
                            -0.09704631567,
                            -0.0944701582193,
                            -0.0971699878573,
                            -0.102425143123,
                            -0.109948992729,
                            -0.118002533913,
                            -0.124716758728,
                            -0.124691016972,
                            -0.114551521838,
                            -0.0932241976261,
                            -0.0676190257072,
                            -0.0470851175487,
                            -0.0333192646503,
                            -0.0243387911469,
                            -0.018880514428,
                            -0.0195927731693,
                            -0.0280874297023,
                            -0.0467231757939,
                            -0.0740106850863,
                            -0.107144363225,
                            -0.137349739671,
                            -0.156432241201,
                            -0.163881450891,
                            -0.162178725004,
                            -0.152594655752,
                            -0.140220448375,
                            -0.130320265889,
                            -0.120370581746,
                            -0.107898145914,
                            -0.0919891670346,
                            -0.0715371444821,
                            -0.0460124015808,
                            -0.0146843269467,
                            0.0224470887333,
                            0.0637699812651,
                            0.10855011642,
                            0.146099805832,
                            0.175431326032,
                            0.196226254106,
                            0.193438455462,
                            0.176038146019,
                            0.149881720543,
                            0.112698510289,
                            0.0795649960637,
                            0.061838131398,
                            0.0526455529034,
                            0.054041698575,
                            0.0652324259281,
                            0.0772970020771,
                            0.0886154770851,
                            0.104912914336,
                            0.125384896994,
                            0.146637007594,
                            0.170937761664,
                            0.192818492651,
                            0.208374321461,
                            0.219454944134,
                            0.221264719963,
                            0.211654737592,
                            0.19436596334,
                            0.166735306382,
                            0.134932398796,
                            0.108625538647,
                            0.0902878493071,
                            0.0836881995201,
                            0.0890489667654,
                            0.100034244359,
                            0.113099709153,
                            0.127909258008,
                            0.142989233136,
                            0.15443778038,
                            0.164153367281,
                            0.176113933325,
                            0.187664479017,
                            0.194292187691,
                            0.195101812482,
                            0.193455949426,
                            0.18904876709,
                            0.182988315821,
                            0.175860449672,
                            0.166750624776,
                            0.159186258912,
                            0.158593967557,
                            0.166781336069,
                            0.178606763482,
                            0.193604111671,
                            0.209490805864,
                            0.220216825604,
                            0.220861658454,
                            0.209052577615,
                            0.18677008152,
                            0.15726596117,
                            0.119941845536,
                            0.0820052996278,
                            0.0561961233616,
                            0.0406291559339,
                            0.0259605050087,
                            0.0114071648568,
                            -0.00578842964023,
                            -0.0306458994746,
                            -0.0590750426054,
                            -0.089625030756,
                            -0.124840028584,
                            -0.158652216196,
                            -0.184026047587,
                            -0.199588358402,
                            -0.20213021338,
                            -0.197490379214,
                            -0.188840061426,
                            -0.176527932286,
                            -0.161645025015,
                            -0.147712767124,
                            -0.13683655858,
                            -0.132947891951,
                            -0.13517665863,
                            -0.140752732754,
                            -0.15201407671,
                            -0.163493320346,
                            -0.174349710345,
                            -0.18685990572,
                            -0.198066830635,
                            -0.210129112005,
                            -0.225079715252,
                            -0.241226404905,
                            -0.255184412003,
                            -0.263642013073,
                            -0.260742664337,
                            -0.245512649417,
                            -0.223610505462,
                            -0.197069987655,
                            -0.168198108673,
                            -0.144044488668,
                            -0.126023799181,
                            -0.113553121686,
                            -0.10803886503,
                            -0.110925927758,
                            -0.12147270143,
                            -0.136453285813,
                            -0.149092122912,
                            -0.160795018077,
                            -0.173751562834,
                            -0.186757594347,
                            -0.195142135024,
                            -0.195981428027,
                            -0.188809290528,
                            -0.175409585238,
                            -0.164079666138,
                            -0.159387886524,
                            -0.157176762819,
                            -0.152238294482,
                            -0.1469335109,
                            -0.144164070487,
                            -0.145618677139,
                            -0.152558892965,
                            -0.165067493916,
                            -0.176886126399,
                            -0.183867573738,
                            -0.181313708425,
                            -0.172765240073,
                            -0.165511786938,
                            -0.151581853628,
                            -0.136098533869,
                            -0.123590812087,
                            -0.108914926648,
                            -0.0859491154552,
                            -0.0500927492976,
                            -0.00915108714253,
                            0.0390794761479,
                            0.100908212364,
                            0.159844830632,
                            0.205166190863,
                            0.240475818515,
                            0.263109117746,
                            0.271664828062,
                            0.262595683336,
                            0.24288469553,
                            0.222085595131,
                            0.199757382274,
                            0.181048884988,
                            0.173460230231,
                            0.182104036212,
                            0.199396729469,
                            0.222645685077,
                            0.235537856817,
                            0.23613551259,
                            0.236820995808,
                            0.22911092639,
                            0.21957474947,
                            0.211064606905,
                            0.205384522676,
                            0.207054689527,
                            0.212045371532,
                            0.217557609081,
                            0.222878590226,
                            0.225227743387,
                            0.221827507019,
                            0.213941112161,
                            0.202775552869,
                            0.195096746087,
                            0.193968132138,
                            0.195469304919,
                            0.197367936373,
                            0.201336473227,
                            0.210417643189,
                            0.223733142018,
                            0.240355819464,
                            0.255863755941,
                            0.268180370331,
                            0.277088522911,
                            0.27899363637,
                            0.276428043842,
                            0.269970923662,
                            0.261037617922,
                            0.249361470342,
                            0.232194513083,
                            0.206586301327,
                            0.177623569965,
                            0.15329401195,
                            0.137020871043,
                            0.129117384553,
                            0.125084042549,
                            0.123243153095,
                            0.122965380549,
                            0.113814175129,
                            0.0922466814518,
                            0.0652711093426,
                            0.0310606043786,
                            -0.0144426263869,
                            -0.0602184310555,
                            -0.0981542617083,
                            -0.126059815288,
                            -0.142911940813,
                            -0.154986083508,
                            -0.169473573565,
                            -0.188050717115,
                            -0.203928738832,
                            -0.215673744678,
                            -0.229370459914,
                            -0.242853626609,
                            -0.255224198103,
                            -0.267261445522,
                            -0.275687783957,
                            -0.276928693056,
                            -0.271708846092,
                            -0.264390438795,
                            -0.25857770443,
                            -0.251077860594,
                            -0.247454866767,
                            -0.243780046701,
                            -0.235748961568,
                            -0.225511953235,
                            -0.216648086905,
                            -0.207931935787,
                            -0.194828554988,
                            -0.183631747961,
                            -0.175895065069,
                            -0.173279121518,
                            -0.180370673537,
                            -0.193213194609,
                            -0.207734122872,
                            -0.223437100649,
                            -0.238589122891,
                            -0.242165610194,
                            -0.242966711521,
                            -0.243707180023,
                            -0.234008103609,
                            -0.215702101588,
                            -0.192110389471,
                            -0.168882131577,
                            -0.150075808167,
                            -0.136320069432,
                            -0.131592273712,
                            -0.135690003633,
                            -0.142256528139,
                            -0.148176625371,
                            -0.15312448144,
                            -0.156856298447,
                            -0.156187430024,
                            -0.14891731739,
                            -0.139091327786,
                            -0.128409266472,
                            -0.115916714072,
                            -0.103068985045,
                            -0.0924494639039,
                            -0.0806761234999,
                            -0.064330086112,
                            -0.0486340820789,
                            -0.0379746221006,
                            -0.0319859534502,
                            -0.0303947813809,
                            -0.0320037528872,
                            -0.0327838584781,
                            -0.0264611206949,
                            -0.0169529933482,
                            -0.0082471081987,
                            0.00018620362971,
                            0.0110676186159,
                            0.0244908854365,
                            0.0332719944417,
                            0.0420885533094,
                            0.0621505230665,
                            0.0934365019202,
                            0.131774246693,
                            0.176989421248,
                            0.219916790724,
                            0.253569573164,
                            0.280786603689,
                            0.29632678628,
                            0.300552129745,
                            0.295847892761,
                            0.279986947775,
                            0.253498226404,
                            0.220101833344,
                            0.18493399024,
                            0.145621985197,
                            0.109275884926,
                            0.0851672589779,
                            0.0683925226331,
                            0.0610903128982,
                            0.0534099154174,
                            0.0460959933698,
                            0.0507521852851,
                            0.054625377059,
                            0.0563976950943,
                            0.0691074132919,
                            0.0865818113089,
                            0.104260072112,
                            0.125977605581,
                            0.14830827713,
                            0.160678863525,
                            0.160291865468,
                            0.150887340307,
                            0.144555047154,
                            0.141212970018,
                            0.135816454887,
                            0.133926510811,
                            0.137139499187,
                            0.14132834971,
                            0.151047959924,
                            0.173117488623,
                            0.201871722937,
                            0.231513291597,
                            0.255510360003,
                            0.271489500999,
                            0.279006719589,
                            0.282155930996,
                            0.281530350447,
                            0.278847455978,
                            0.27114418149,
                            0.254770636559,
                            0.233506113291,
                            0.204302638769,
                            0.175415441394,
                            0.153003752232,
                            0.131775379181,
                            0.108020491898,
                            0.0887656658888,
                            0.0794457569718,
                            0.0660858526826,
                            0.0442677624524,
                            0.0164883509278,
                            -0.0205640755594,
                            -0.0631168782711,
                            -0.102658629417,
                            -0.135741084814,
                            -0.155288860202,
                            -0.155260801315,
                            -0.149371802807,
                            -0.140528619289,
                            -0.128814011812,
                            -0.11966483295,
                            -0.120613753796,
                            -0.1274266541,
                            -0.139766693115,
                            -0.163537621498,
                            -0.183685258031,
                            -0.193172544241,
                            -0.188033282757,
                            -0.167012512684,
                            -0.143076211214,
                            -0.122455365956,
                            -0.107640899718,
                            -0.0990264862776,
                            -0.094358175993,
                            -0.0966232642531,
                            -0.10691511631,
                            -0.116287082434,
                            -0.121926918626,
                            -0.126649931073,
                            -0.128972873092,
                            -0.127973854542,
                            -0.126497685909,
                            -0.132034242153,
                            -0.148129269481,
                            -0.169336944818,
                            -0.182106256485,
                            -0.182049244642,
                            -0.173214018345,
                            -0.156165674329,
                            -0.135240525007,
                            -0.114528208971,
                            -0.0935522913933,
                            -0.0755098834634,
                            -0.0643693655729,
                            -0.0605688169599,
                            -0.0639396831393,
                            -0.0726749226451,
                            -0.0842186585069,
                            -0.0992660745978,
                            -0.119229644537,
                            -0.139726668596,
                            -0.161787673831,
                            -0.179388388991,
                            -0.187107264996,
                            -0.189710468054,
                            -0.188388824463,
                            -0.184870228171,
                            -0.183842584491,
                            -0.181355983019,
                            -0.170474722981,
                            -0.153143852949,
                            -0.130377560854,
                            -0.109260007739,
                            -0.10022701323,
                            -0.0993848443031,
                            -0.102825731039,
                            -0.111355677247,
                            -0.120034940541,
                            -0.1273432374,
                            -0.135374054313,
                            -0.137481898069,
                            -0.130115747452,
                            -0.112271718681,
                            -0.089504852891,
                            -0.0723860859871,
                            -0.0526957958937,
                            -0.0239651352167,
                            0.00543857365847,
                            0.0279833748937,
                            0.0525241568685,
                            0.0830086097121,
                            0.107270158827,
                            0.131938681006,
                            0.160203188658,
                            0.168085992336,
                            0.165691137314,
                            0.165974140167,
                            0.149937555194,
                            0.129427373409,
                            0.116681084037,
                            0.103277370334,
                            0.0934564620256,
                            0.0947154760361,
                            0.102348715067,
                            0.111423805356,
                            0.128330633044,
                            0.150822758675,
                            0.166165590286,
                            0.178271397948,
                            0.189608961344,
                            0.196010529995,
                            0.19849409163,
                            0.19976913929,
                            0.204997822642,
                            0.205565258861,
                            0.190279111266,
                            0.16264757514,
                            0.138619378209,
                            0.126911431551,
                            0.127811029553,
                            0.141211137176,
                            0.157009854913,
                            0.177667185664,
                            0.197350248694,
                            0.213049441576,
                            0.228965803981,
                            0.236782774329,
                            0.236171647906,
                            0.225791662931,
                            0.212091192603,
                            0.205921947956,
                            0.205685377121,
                            0.207375511527,
                            0.211056560278,
                            0.21067622304,
                            0.204046338797,
                            0.190389856696,
                            0.165651157498,
                            0.141479030252,
                            0.128697127104,
                            0.124544128776,
                            0.127721428871,
                            0.13901053369,
                            0.149727165699,
                            0.152729392052,
                            0.145198300481,
                            0.1261190027,
                            0.102788463235,
                            0.080030426383,
                            0.0568305291235,
                            0.0328717827797,
                            0.0100217033178,
                            -0.0119937332347,
                            -0.0362334549427,
                            -0.0590333342552,
                            -0.076438292861,
                            -0.08822453022,
                            -0.0985361859202,
                            -0.1122892946,
                            -0.131587773561,
                            -0.150892198086,
                            -0.161601692438,
                            -0.166317328811,
                            -0.169263124466,
                            -0.170766323805,
                            -0.170871213078,
                            -0.169189184904,
                            -0.164688959718,
                            -0.158321961761,
                            -0.150482550263,
                            -0.14211781323,
                            -0.136976793408,
                            -0.137325167656,
                            -0.145785361528,
                            -0.167229279876,
                            -0.198985025287,
                            -0.230284318328,
                            -0.254665493965,
                            -0.276968717575,
                            -0.295406222343,
                            -0.304997682571,
                            -0.304281949997,
                            -0.291209101677,
                            -0.273082792759,
                            -0.25181466341,
                            -0.23163536191,
                            -0.2139890939,
                            -0.197437599301,
                            -0.174752607942,
                            -0.148026198149,
                            -0.122246839106,
                            -0.0970052480698,
                            -0.0702750533819,
                            -0.0434043705463,
                            -0.0244666934013,
                            -0.0119948294014,
                            -0.00949260499328,
                            -0.0162531267852,
                            -0.0303638931364,
                            -0.0543143823743,
                            -0.0882575213909,
                            -0.127967104316,
                            -0.1690685004,
                            -0.204503282905,
                            -0.223266780376,
                            -0.223913356662,
                            -0.213588550687,
                            -0.206865638494,
                            -0.214125737548,
                            -0.227135241032,
                            -0.235617876053,
                            -0.241262346506,
                            -0.240892991424,
                            -0.229192554951,
                            -0.205610707402,
                            -0.173897787929,
                            -0.135868787766,
                            -0.0928762927651,
                            -0.0548302084208,
                            -0.016679238528,
                            0.030372492969,
                            0.0776739418507,
                            0.117727868259,
                            0.152581915259,
                            0.18307518959,
                            0.217419207096,
                            0.255835652351,
                            0.287320673466,
                            0.31157079339,
                            0.319250881672,
                            0.314350754023,
                            0.303062349558,
                            0.283758342266,
                            0.264358460903,
                            0.239673867822,
                            0.212910547853,
                            0.196452245116,
                            0.184309393167,
                            0.168304488063,
                            0.153669118881,
                            0.151096880436,
                            0.153414919972,
                            0.152029037476,
                            0.155356928706,
                            0.166108265519,
                            0.174451455474,
                            0.182007133961,
                            0.190551131964,
                            0.196235388517,
                            0.193864688277,
                            0.180522575974,
                            0.16499915719,
                            0.150438278913,
                            0.148344069719,
                            0.158679455519,
                            0.17534263432,
                            0.196648716927,
                            0.217027693987,
                            0.23870383203,
                            0.258655697107,
                            0.272141605616,
                            0.274808317423,
                            0.271112501621,
                            0.262106120586,
                            0.247949495912,
                            0.231651335955,
                            0.211977258325,
                            0.196243479848,
                            0.192779034376,
                            0.19463698566,
                            0.186818420887,
                            0.167738810182};

// Declare JNI function
extern "C" {
JNIEXPORT void JNICALL
Java_com_ece420_lab3_MainActivity_getFftBuffer(JNIEnv *env, jclass, jobject bufferPtr);
}

// FRAME_SIZE is 1024 and we zero-pad it to 2048 to do FFT
#define FRAME_SIZE 1024
#define ZP_FACTOR 2
#define FFT_SIZE (FRAME_SIZE * ZP_FACTOR)
// Variable to store final FFT output
float fftOut[FFT_SIZE] = {};
bool isWritingFft = false;

void ece420ProcessFrame(sample_buf *dataBuf) {
    isWritingFft = false;

    // Keep in mind, we only have 20ms to process each buffer!
    struct timeval start;
    struct timeval end;

    kiss_fft_cpx fftBufIn[FFT_SIZE] = {};
    kiss_fft_cpx fftBufOut[FFT_SIZE] = {};

    gettimeofday(&start, NULL);

    float maxval;
    float minval;

    // Data is encoded in signed PCM-16, little-endian, mono channel
    float bufferIn[FRAME_SIZE];


    for (int i = 0; i < FRAME_SIZE; i++) {
        int16_t val =
                ((uint16_t) dataBuf->buf_[2 * i]) | (((uint16_t) dataBuf->buf_[2 * i + 1]) << 8);
        bufferIn[i] = (float) val;
    }

    // Spectrogram is just a fancy word for short time fourier transform
    // 1. Apply hamming window to the entire FRAME_SIZE
    for (int i = 0; i < FRAME_SIZE; i++) {
        float wi = float(0.54 - 0.46 * cos(2. * M_PI * i / (FRAME_SIZE - 1)));
        fftBufIn[i].r = bufferIn[i] * wi;
        fftBufIn[i].i = 0.0f;
    }

    // 2. Zero padding to FFT_SIZE = FRAME_SIZE * ZP_FACTOR
    for (int i = FRAME_SIZE; i < FFT_SIZE; i++) {
        fftBufIn[i].r = 0.0f;
        fftBufIn[i].i = 0.0f;
    }

    // 3. Apply fft with KISS_FFT engine
    kiss_fft_cfg cfg = kiss_fft_alloc(FFT_SIZE, false, 0, 0);


    // put kth sample in cx_in[k].r and cx_in[k].i
    kiss_fft(cfg, fftBufIn, fftBufOut);


    // transformed. DC is in cx_out[0].r and cx_out[0].i

    kiss_fft_free(cfg);

    // 4. Scale fftOut[] to between 0 and 1 with log() and linear scaling
    // NOTE: This code block is a suggestion to get you started. You will have to
    // add/change code outside this block to implement FFT buffer overlapping (extra credit part).
    // Keep all of your code changes within java/MainActivity and cpp/ece420_*
    // ********************* START YOUR CODE HERE *********************** //
    int i = 0;
    maxval = 20.0f * log10(fftBufOut[i].r * fftBufOut[i].r + fftBufOut[i].i * fftBufOut[i].i);
    minval = maxval;
    for (i = 1; i < FRAME_SIZE; i++) {
        fftOut[i] = fftBufOut[i].r * fftBufOut[i].r + fftBufOut[i].i * fftBufOut[i].i;
        fftOut[i] = 20.0f * log10(fftOut[i]);
        maxval = fftOut[i] > maxval ? fftOut[i] : maxval;
        minval = fftOut[i] < minval ? fftOut[i] : minval;
    }

    for (i = 0; i < FRAME_SIZE; i++) {
//\            fftOut[i] = (fftOut[i]-minval) / (maxval-minval);
        fftOut[i] = fftOut[i] / maxval;
    }


    // thread-safe
    isWritingFft = true;
    // Currently set everything to 0 or 1 so the spectrogram will just be blue and red stripped
//    for (int i = 0; i < FRAME_SIZE; i++) {
//        fftOut[i] = (i/20)%2;
//    }
//--------------------------------------------------------------------------------------------------
    int frameSize = 1024;
    int sampleRate = 44100;
    Gist<double> g(frameSize, sampleRate, WindowType::RectangularWindow);

    std::vector<double> testFrame(1024);

    for (int i = 0; i < 1024; i++) {
        testFrame[i] = bufferIn[i];
    }

//    testFrame[0] = 1.0;

    g.processAudioFrame(testFrame);

    std::vector<double> mag;

    mag = g.getMagnitudeSpectrum();

    double t = -1;
    t = g.complexSpectralDifference();
    LOGD("complexSpectralDifference:%f ", t);
    t = g.energyDifference();
    LOGD("energyDifference:%f ", t);
    t = g.highFrequencyContent();
    LOGD("highFrequencyContent:%f ", t);
    t = g.peakEnergy();
    LOGD("peakEnergy:%f ", t);
    t = g.pitch();
    LOGD("pitch:%f ", t);
    t = g.rootMeanSquare();
    LOGD("rootMeanSquare:%f ", t);
    t = g.spectralCentroid();
    LOGD("spectralCentroid:%f ", t);
    t = g.spectralCrest();
    LOGD("spectralCrest:%f ", t);
    t = g.spectralDifference();
    LOGD("spectralDifference:%f ", t);
    t = g.spectralFlatness();
    LOGD("spectralFlatness:%f ", t);
    t = g.spectralKurtosis();
    LOGD("spectralKurtosis:%f ", t);
    t = g.spectralRolloff();
    LOGD("spectralRolloff:%f ", t);
    t = g.zeroCrossingRate();
    LOGD("zeroCrossingRate:%f ", t);
    std::vector<double> mfcc;
    mfcc = g.getMelFrequencyCepstralCoefficients();
    for (int i = 0; i < 13; i++) {
        LOGD("mfcc:%f ", mfcc[i]);
    }
    LOGD(" ");

//--------------------------------------------------------------------------------------------------
    // ********************* END YOUR CODE HERE ************************* //
    // Flip the flag so that the JNI thread will update the buffer
    isWritingFft = false;

    gettimeofday(&end, NULL);
    LOGD("Time delay: %ld us",
         ((end.tv_sec * 1000000 + end.tv_usec) - (start.tv_sec * 1000000 + start.tv_usec)));
}


// http://stackoverflow.com/questions/34168791/ndk-work-with-floatbuffer-as-parameter
JNIEXPORT void JNICALL
Java_com_ece420_lab3_MainActivity_getFftBuffer(JNIEnv *env, jclass, jobject bufferPtr) {
    jfloat *buffer = (jfloat *) env->GetDirectBufferAddress(bufferPtr);
    // thread-safe, kinda
    while (isWritingFft) {}
    // We will only fetch up to FRAME_SIZE data in fftOut[] to draw on to the screen
    for (int i = 0; i < FRAME_SIZE; i++) {
        buffer[i] = fftOut[i];
    }
}
